var approve=approve||{},reject=reject||{},action_view_doc=action_view_doc||{},setting_ob=setting_ob||{};jQuery(function(a){!function(e,t,o){var i=a(o),n=location.protocol+"//devlogin.vcoinapp.com/",r=Handlebars.compile(a("#editor_details_template").html());if("administrator"==setting_ob.role)var s="app_reg_admin_processing",d=!0;else if("developer"==setting_ob.role)var s="app_reg_log",d=!1;var l={successcb:function(){i.fnReloadAjax(n+"api/systemlog/"+s)}},p=function(e,o){e instanceof jQuery&&"function"==typeof o?e.size()>0&&(e.off(t),e.on(t,function(e){e.preventDefault();var t=a(this),i=t.attr("data-id");o(t,i)})):console.log("not in the right format")},c=function(e){new p(a(".action_withdraw_application",e),function(a,e){console.log(e);var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/remove_pending_app",{id:e},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_disable_application",e),function(a,e){var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/app_alive_to_dead",{post_id:e},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_remove_application",e),function(a,e){var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/remove_dead_app",{post_id:e},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_enable_application",e),function(a,e){var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/app_dead_to_alive",{post_id:e},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_approve_application",e),function(a,e){var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/admin_approve_app",{id:e,action:"approve"},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_launch_application",e),function(a,e){console.log(e);var t=new AJAXLoader(a,"normal","app_reg");a.addClass("disabled");var o=new JAXAPIsupport(n+"api/cms/app_developer_launch_app",{id:e,action:"finallyalive"},a,l.successcb);o.add_loader(t),o.init()}),new p(a(".action_reject_application",e),function(e){e.addClass("disabled"),a(".action_approve_application").addClass("disabled"),a(".reason_display",e.parent().parent().parent()).show()}),new p(a(".action_reject_confirm_application",e),function(t,o){var i=new AJAXLoader(t,"normal","app_reg"),r=a("option:selected",e).val(),s=a("#otherreason",e).val();if(t.hasClass("disabled")||""==s||""==r)console.log("withdraw failed."),alert("Enter withdraw reason.");else{t.addClass("disabled"),MetaBoxSupport.InputControlSingle(a(".action_approve_application"),!0);var d=new JAXAPIsupport(n+"api/cms/remove_pending_app",{id:o,written:s,choice:r},t,l.successcb);d.add_loader(i),d.init()}})},_=function(){var e=a("td.details_editor .view_actions",o);e.off("cancel_reveal"),e.off(t),e.on("cancel_reveal",function(e,t){e.preventDefault();var o=a(this).closest("tr"),n=i.dataTable().api().row(o),r=Number(a(this).attr("data-id"));n.child.isShown()&&r!=t&&(n.child.hide(),o.removeClass("shown"))}),e.on(t,function(e){e.preventDefault();var t=a(this).closest("tr"),n=i.dataTable().api().row(t),r=n.data(),s={};if(n.child.isShown())n.child.hide(),t.removeClass("shown"),console.log("1 bar now");else{if("developer"==setting_ob.role)s=Handlebars.compile(a("#editor_childrow_"+r.status).html()),n.child(s(r)).show(),c(t.next());else{var d=Handlebars.compile(a("#editor_childrow_permission").html());Handlebars.registerHelper("control_admin",function(){return"pending"==this.status?new Handlebars.SafeString(d(this)):""}),s=Handlebars.compile("pending"!=r.status?a("#editor_childrow_"+r.status).html():a("#editor_childrow_admin").html()),"beta"!=r.status&&(n.child(s(r)).show(),c(t.next()))}t.addClass("shown")}a("td.details_editor .view_actions",o).trigger("cancel_reveal",[r.ID])})};i.dataTable({processing:!0,serverSide:d,iDisplayLength:6,order:[1,"desc"],ajax:n+"api/systemlog/"+s,columns:[{"class":"details_editor",orderable:!1,render:function(a,e,t){return r(t)}},{data:"ID"},{data:"devuser"},{data:"devname",render:function(a){return"developer"==setting_ob.role?"":"administrator"==setting_ob.role?a:void 0}},{data:"status",render:function(a){return a}},{data:"store_id"},{data:"app_key"},{data:"app_secret"},{data:"platform"}],dom:'<"sort_status">lfrtip',initComplete:function(){if("administrator"==setting_ob.role){var e=Handlebars.compile(a("#editor_btns").html()),o=a("div.sort_status");o.html(e),o.css({"text-align":"center","padding-top":"20px"}),o=a("div.sort_status");var r=a("button",o);r.each(function(){a(this).on(t,function(){i.fnReloadAjax(n+"api/systemlog/"+s+"/?sort="+a(this).html().toLowerCase())})})}i.css({"text-align":"center","font-size":"14px"}),"developer"==setting_ob.role&&(i.DataTable().column(2).visible(!1),i.DataTable().column(3).visible(!1))},fnDrawCallback:_})}(document,"click tap touch","#admin_page_app_reg")});
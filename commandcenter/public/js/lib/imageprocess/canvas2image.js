/**
 * Created by hesk on 1/12/14.
 */
var Canvas2Image=function(){var e=false;var t=document.createElement("canvas");if(t.getContext("2d")){e=true}if(!e){return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}}}var n=!!t.getContext("2d").getImageData;var r=!!t.toDataURL;var i=!!window.btoa;var s="image/octet-stream";var o=function(e){var t=parseInt(e.width);var n=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,n)};var u=function(e){var t="";if(typeof e=="string"){t=e}else{var n=e;for(var r=0;r<n.length;r++){t+=String.fromCharCode(n[r])}}return btoa(t)};var a=function(e){var t=[];var n=e.width;var r=e.height;t.push(66);t.push(77);var i=n*r*3+54;t.push(i%256);i=Math.floor(i/256);t.push(i%256);i=Math.floor(i/256);t.push(i%256);i=Math.floor(i/256);t.push(i%256);t.push(0);t.push(0);t.push(0);t.push(0);t.push(54);t.push(0);t.push(0);t.push(0);var s=[];s.push(40);s.push(0);s.push(0);s.push(0);var o=n;s.push(o%256);o=Math.floor(o/256);s.push(o%256);o=Math.floor(o/256);s.push(o%256);o=Math.floor(o/256);s.push(o%256);var a=r;s.push(a%256);a=Math.floor(a/256);s.push(a%256);a=Math.floor(a/256);s.push(a%256);a=Math.floor(a/256);s.push(a%256);s.push(1);s.push(0);s.push(24);s.push(0);s.push(0);s.push(0);s.push(0);s.push(0);var f=n*r*3;s.push(f%256);f=Math.floor(f/256);s.push(f%256);f=Math.floor(f/256);s.push(f%256);f=Math.floor(f/256);s.push(f%256);for(var l=0;l<16;l++){s.push(0)}var c=(4-n*3%4)%4;var h=e.data;var p="";var d=r;do{var v=n*(d-1)*4;var m="";for(var g=0;g<n;g++){var y=4*g;m+=String.fromCharCode(h[v+y+2]);m+=String.fromCharCode(h[v+y+1]);m+=String.fromCharCode(h[v+y])}for(var b=0;b<c;b++){m+=String.fromCharCode(0)}p+=m}while(--d);var w=u(t.concat(s))+u(p);return w};var f=function(e){document.location.href=e};var l=function(e,t){return"data:"+t+";base64,"+e};var c=function(e){var t=document.createElement("img");t.src=e;return t};var h=function(e,t,n){if(t&&n){var r=document.createElement("canvas");r.width=t;r.height=n;r.style.width=t+"px";r.style.height=n+"px";var i=r.getContext("2d");i.drawImage(e,0,0,e.width,e.height,0,0,t,n);return r}return e};return{saveAsPNG:function(e,t,n,i){if(!r){return false}var o=h(e,n,i);var u=o.toDataURL("image/png");if(t){return c(u)}else{f(u.replace("image/png",s))}return true},saveAsJPEG:function(e,t,n,i){if(!r){return false}var o=h(e,n,i);var u="image/jpeg";var a=o.toDataURL(u);if(a.indexOf(u)!=5){return false}if(t){return c(a)}else{f(a.replace(u,s))}return true},saveAsBMP:function(e,t,r,u){if(!(n&&i)){return false}var p=h(e,r,u);var d=o(p);var v=a(d);if(t){return c(l(v,"image/bmp"))}else{f(l(v,s))}return true}}}()